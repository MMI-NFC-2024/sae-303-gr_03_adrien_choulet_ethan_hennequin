---
import Layout from '../layouts/Layout.astro';
---
<Layout>
  <section class="bg-white py-16 px-4">
    <div class="max-w-screen-xl mx-auto">
      <h1 class="text-4xl font-bold text-gray-900 text-center mb-4">
        Carte des différentes gares de France et des lignes ferroviaires de Bourgogne Franche-Comté
      </h1>

      

      <!-- Carte -->
      <div id="plangare" class="w-full h-[600px] rounded-lg shadow border border-gray-200"></div>
    
    </div>
  </section>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <p class="text-center text-gray-700 text-lg max-w-3xl mx-auto mb-8">
        L’objectif principal de ce projet est d’offrir à l’utilisateur une vision claire et complète du réseau ferroviaire en Bourgogne-Franche-Comté. En mettant en avant les différentes lignes de train ainsi que les gares régionales, cette approche vise à faciliter la compréhension des possibilités de déplacement au sein du territoire. Elle s’inscrit dans une logique d’accessibilité et de valorisation des infrastructures existantes, en permettant à chacun de mieux appréhender la structure du réseau de transport régional.

Au-delà de l’aspect informatif, le projet cherche à guider l’utilisateur dans ses choix de mobilité. En visualisant les connexions ferroviaires les plus pertinentes, il devient plus simple de planifier un trajet efficace pour se rendre dans les lieux culturels de la région. Cette représentation des données peut également souligner les zones moins bien desservies, offrant ainsi des perspectives d’amélioration pour la mobilité territoriale. 

Enfin, cette démarche contribue à promouvoir les mobilités durables en incitant les usagers à privilégier le train ou les correspondances de covoiturage plutôt que des modes de transport individuels et polluants. En rendant visibles les accès possibles aux sites culturels par des moyens de transport écologiques, le projet participe à une dynamique globale de développement durable et de valorisation du patrimoine régional.
      </p>

  <!-- Script d’intégration -->
  <script type="module">
    import departementsBourgogneFrancheComteGeojson from "/public/departements-bourgogne-franche-comte.geojson.json";
    import voie_ferre from "/public/voie_Ferre@1.geojson.json";
    import gares from "/public/gares-de-voyageurs.geojson.json";

    function createTileLayer() {
      return L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors"
      });
    }

    function styleDepartements(feature) {
      return {
        color: "#999",
        weight: 1,
        fillColor: "#f0f0f0",
        fillOpacity: 0.5
      };
    }

    function styleVoiesFerrees(feature) {
      return {
        color: "crimson",
        weight: 2
      };
    }

    function styleGares(feature) {
      return {
        radius: 6,
        fillColor: "blue",
        color: "#333",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
      };
    }

    function createDepartementsLayer(geojson) {
      return L.geoJSON(geojson, {
        style: styleDepartements
      });
    }

    function createVoiesFerreesLayer(geojson) {
      return L.geoJSON(geojson, {
        style: styleVoiesFerrees
      });
    }

    function createGaresLayer(geojson) {
      return L.geoJSON(geojson, {
        pointToLayer: (feature, latlng) => L.circleMarker(latlng, styleGares(feature)),
        onEachFeature: (feature, layer) => {
          const props = feature.properties;
          const nom = props["nom_gare"] || props["NOM"] || "Gare";
          const commune = props["commune"] || props["COMMUNE"] || "";
          const codeUIC = props["code_uic"] || props["UIC"] || "";
          const html = `
            <div style="font-family: 'Inter', sans-serif; font-size: 14px;">
              <strong style="font-size: 16px; color: #2c3e50;">${nom}</strong><br/>
              ${commune ? `<span>Commune : ${commune}</span><br/>` : ""}
              ${codeUIC ? `<span>Code UIC : ${codeUIC}</span><br/>` : ""}
            </div>
          `;
          layer.bindPopup(html);
        }
      });
    }

    function initMap({ departements, voiesFerrees, gares }) {
      const map = L.map("plangare").setView([47.5, 6.8], 8);
      createTileLayer().addTo(map);
      createDepartementsLayer(departements).addTo(map);
      createVoiesFerreesLayer(voiesFerrees).addTo(map);
      createGaresLayer(gares).addTo(map);
    }

    initMap({
      departements: departementsBourgogneFrancheComteGeojson,
      voiesFerrees: voie_ferre,
      gares: gares
    });
  </script>
</Layout>

