---
import Layout from '../layouts/Layout.astro';
---
<Layout>
  <section class="bg-white py-16 px-4">
    <div class="max-w-screen-xl mx-auto">
      <h1 class="text-4xl font-bold text-gray-900 text-center mb-4">
        Carte des différentes gares de France et des lignes ferroviaires de Bourgogne Franche-Comté
      </h1>

      <p class="text-center text-gray-700 text-lg max-w-3xl mx-auto mb-8">
        L'objectif est d'informer l'utilisateur sur les différentes lignes ferroviaires et gares de Bourgogne Franche-Comté afin de savoir comment se rendre dans tels ou tels lieux culturels de la façon la plus simple possible.
      </p>

      <!-- Carte -->
      <div id="plangare" class="w-full h-[600px] rounded-lg shadow border border-gray-200"></div>
    </div>
  </section>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Script d’intégration -->
  <script type="module">
    import departementsBourgogneFrancheComteGeojson from "/src/assets/departements-bourgogne-franche-comte.geojson.json";
    import voie_ferre from "/src/assets/voie_Ferre@1.geojson.json";
    import gares from "/src/assets/gares-de-voyageurs.geojson.json";

    function createTileLayer() {
      return L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap contributors"
      });
    }

    function styleDepartements(feature) {
      return {
        color: "#999",
        weight: 1,
        fillColor: "#f0f0f0",
        fillOpacity: 0.5
      };
    }

    function styleVoiesFerrees(feature) {
      return {
        color: "crimson",
        weight: 2
      };
    }

    function styleGares(feature) {
      return {
        radius: 6,
        fillColor: "blue",
        color: "#333",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
      };
    }

    function createDepartementsLayer(geojson) {
      return L.geoJSON(geojson, {
        style: styleDepartements
      });
    }

    function createVoiesFerreesLayer(geojson) {
      return L.geoJSON(geojson, {
        style: styleVoiesFerrees
      });
    }

    function createGaresLayer(geojson) {
      return L.geoJSON(geojson, {
        pointToLayer: (feature, latlng) => L.circleMarker(latlng, styleGares(feature)),
        onEachFeature: (feature, layer) => {
          const props = feature.properties;
          const nom = props["nom_gare"] || props["NOM"] || "Gare";
          const commune = props["commune"] || props["COMMUNE"] || "";
          const codeUIC = props["code_uic"] || props["UIC"] || "";
          const html = `
            <div style="font-family: 'Inter', sans-serif; font-size: 14px;">
              <strong style="font-size: 16px; color: #2c3e50;">${nom}</strong><br/>
              ${commune ? `<span>Commune : ${commune}</span><br/>` : ""}
              ${codeUIC ? `<span>Code UIC : ${codeUIC}</span><br/>` : ""}
            </div>
          `;
          layer.bindPopup(html);
        }
      });
    }

    function initMap({ departements, voiesFerrees, gares }) {
      const map = L.map("plangare").setView([47.5, 6.8], 8);
      createTileLayer().addTo(map);
      createDepartementsLayer(departements).addTo(map);
      createVoiesFerreesLayer(voiesFerrees).addTo(map);
      createGaresLayer(gares).addTo(map);
    }

    initMap({
      departements: departementsBourgogneFrancheComteGeojson,
      voiesFerrees: voie_ferre,
      gares: gares
    });
  </script>
</Layout>

